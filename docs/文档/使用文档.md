# NovaLang 使用文档

## 简介

NovaLang 是一门运行在 JVM 上的脚本语言，采用类似 Kotlin 的语法风格。它支持面向对象编程、函数式编程、空安全、Java 互操作等特性，同时提供 REPL 交互模式和脚本执行模式。

## 相关文档

| 文档 | 说明 |
|------|------|
| [语法文档](语法文档.md) | Nova 语言语法参考 |
| [内置函数参考](内置函数参考.md) | 内置函数、类型方法、作用域函数 |
| [嵌入式使用指南](嵌入式使用指南.md) | 在 Java/Kotlin 中嵌入 NovaLang |
| [Java互操作指南](Java互操作指南.md) | 在 Nova 中调用 Java 类库 |

## 快速开始

创建文件 `hello.nova`：

```nova
val name = "World"
println("Hello, $name!")
```

运行：

```bash
nova hello.nova
```

输出：

```
Hello, World!
```

## CLI 命令

### REPL 交互模式

```bash
nova
```

无参数启动时进入 REPL 交互模式，可逐行输入并立即查看结果。

### 执行脚本

```bash
nova script.nova
nova script.nova arg1 arg2
```

执行 `.nova` 脚本文件。传递的参数可通过全局变量 `args` 获取（`List<String>` 类型）。

### 执行表达式

```bash
nova -e "1 + 2 * 3"
```

直接求值表达式并输出结果。

### 编译为字节码

```bash
nova -c app.nova               # 编译为 .class 文件
nova -c app.nova -o out         # 指定输出目录
```

### 构建项目

```bash
nova build src                  # 增量编译 src 目录
nova build src --jar app.jar    # 编译并打包为 JAR
```

### 格式化代码

```bash
nova fmt app.nova                    # 格式化文件
nova fmt app.nova --indent-size 2    # 自定义缩进大小
```

### 安全沙箱

```bash
nova --sandbox strict script.nova       # 严格模式
nova --sandbox standard script.nova     # 标准模式
nova --sandbox unrestricted script.nova # 无限制模式（默认）
```

## REPL 命令

在 REPL 模式中可使用以下命令：

| 命令 | 简写 | 功能 |
|------|------|------|
| `:help` | `:h` | 显示帮助信息 |
| `:quit` | `:q` / `:exit` | 退出 REPL |
| `:clear` | `:c` | 清屏 |
| `:reset` | | 重置环境（清除所有变量和函数定义） |
| `:env` | | 显示当前环境中的所有变量 |
| `:version` | | 显示版本信息 |

### 多行输入

在行尾添加 `\` 或保持括号未闭合，即可进入多行输入模式：

```
nova> val result = 1 + \
...>   2 + 3
6

nova> fun add(a: Int, b: Int): Int {
...>     return a + b
...> }
```

## 脚本参数

执行脚本时传入的参数通过全局变量 `args` 访问：

```nova
// run.nova
for (arg in args) {
    println(arg)
}
```

```bash
nova run.nova hello world
# 输出：
# hello
# world
```

## 安全沙箱

NovaLang 提供三级安全沙箱策略：

### UNRESTRICTED（默认）

无任何限制，可自由使用所有功能，包括 Java 互操作。适合本地受信任脚本。

### STANDARD

允许受限的 Java 互操作：
- **允许的包**：java.util、java.math、java.time、java.text、java.lang
- **禁止的包**：java.io、java.nio、java.net、java.lang.reflect
- **禁止的类**：Runtime、ProcessBuilder、ClassLoader、Thread
- **禁止的方法**：System.exit、System.load
- **资源限制**：30 秒超时、256 层递归、1000 万次循环迭代

### STRICT

完全禁止 Java 互操作，仅允许 Nova 内置函数和 println/readLine：
- **资源限制**：10 秒超时、128 层递归、100 万次循环迭代

```bash
# 在标准沙箱下运行不受信任的脚本
nova --sandbox standard untrusted.nova

# 在严格沙箱下运行
nova --sandbox strict untrusted.nova
```

> 嵌入式场景下的安全策略配置详见 [嵌入式使用指南](嵌入式使用指南.md#安全策略)。

## VS Code 扩展

NovaLang 提供 VS Code 扩展，支持：

- **语法高亮**：关键字、字符串、注释、操作符等
- **LSP 智能提示**：
  - 代码补全（`.` 触发）
  - 悬停文档
  - 跳转到定义
  - 诊断错误提示

安装方式：在 VS Code 扩展面板中搜索 "Nova Language"，或从 `vscode-nova/` 目录本地安装。
