# 编译期常量 (const val)

`const val` 声明编译期常量，值在编译时确定并内联到使用处。

---

## 语法

```nova
const val NAME = "NovaLang"
const val MAX_SIZE = 1024
const val TAU = 3.14159265 * 2
```

## 规则

- **必须使用 `val`**：`const var` 不允许
- **必须有初始化器**：`const val x: Int` 不允许
- **初始化器必须是编译期常量表达式**

### 允许的常量表达式

| 类型 | 示例 |
|------|------|
| 字面量 | `42`, `3.14`, `"hello"`, `true`, `'A'` |
| 一元运算 | `-42`, `+3.14` |
| 二元运算 | `1 + 2`, `"a" + "b"`, `10 * 3` |
| const 引用 | `const val Y = X + 1`（X 须为已声明的 const） |

支持的二元运算符：`+` `-` `*` `/` `%`

字符串拼接也通过 `+` 支持：

```nova
const val GREETING = "Hello, " + "World!"
```

### 不允许的表达式

```nova
const val a = foo()       // 函数调用
const val b = list[0]     // 索引访问
const val c = null        // null
const val d = if (x) 1 else 2  // 条件表达式
```

---

## 编译行为

编译模式下，`const val` 会被优化：

- **类级别**：生成 `public static final` 字段，带 JVM `ConstantValue` 属性
- **方法体内**：不分配局部变量槽，使用处直接内联值
- **使用处**：生成 `LDC`（或 `ICONST` 等）指令，而非 `GETSTATIC`/`GETFIELD`

```nova
const val X = 42
println(X)  // 编译为: LDC 42 → println，无变量读取
```

解释模式下 `const val` 与 `val` 行为一致，仅做基本验证。

---

## 错误示例

```nova
const var z = 1        // 错误: const must be val
const val w: Int       // 错误: const val must have an initializer
const val f = foo()    // 错误: const val initializer must be a compile-time constant
```
