# 内置函数参考

以下函数和常量无需 import，在全局作用域中直接可用。

---

## I/O 函数

| 函数 | 说明 |
|------|------|
| `println(values...)` | 打印值并换行，多个值用空格分隔 |
| `print(values...)` | 打印值，不换行 |
| `readLine()` | 读取一行输入，EOF 时返回 null |
| `input(prompt)` | 显示提示信息后读取一行输入 |

```nova
print("请输入姓名：")
val name = readLine()
println("你好, $name!")

// 或使用 input
val age = input("请输入年龄：")
```

## 类型转换函数

| 函数 | 说明 |
|------|------|
| `toInt(value)` | 转换为 Int，字符串或数字类型 |
| `toLong(value)` | 转换为 Long |
| `toDouble(value)` | 转换为 Double |
| `toFloat(value)` | 转换为 Float |
| `toString(value)` | 转换为 String |
| `toBoolean(value)` | 转换为 Boolean（truthy 判断） |
| `toChar(value)` | 转换为 Char（Int 转码点，单字符 String 取首字符） |

```nova
val n = toInt("42")       // 42
val d = toDouble("3.14")  // 3.14
val f = toFloat(3.14)     // 3.14f
val s = toString(100)     // "100"
val c = toChar(65)        // 'A'
```

## 类型检查函数

| 函数 | 说明 |
|------|------|
| `typeof(value)` | 返回类型名称字符串 |
| `isNull(value)` | 是否为 null |
| `isNumber(value)` | 是否为数字类型 |
| `isString(value)` | 是否为字符串 |
| `isList(value)` | 是否为列表 |
| `isMap(value)` | 是否为 Map |
| `isCallable(value)` | 是否可调用（函数/Lambda） |

```nova
typeof(42)         // "Int"
typeof("hello")    // "String"
typeof('A')        // "Char"
typeof(3.14)       // "Double"
isNumber(3.14)     // true
isCallable({ x -> x }) // true
```

## 集合创建函数

| 函数 | 说明 |
|------|------|
| `listOf(values...)` | 创建列表 |
| `mutableListOf(values...)` | 创建可变列表 |
| `emptyList()` | 创建空列表 |
| `mapOf(pairs...)` | 创建 Map |
| `emptyMap()` | 创建空 Map |
| `setOf(values...)` | 创建 Set |
| `mutableSetOf(values...)` | 创建可变 Set |
| `emptySet()` | 创建空 Set |
| `arrayOf(values...)` | 创建原生数组 |
| `Array<T>(size)` | 创建指定大小的空数组 |
| `Array<T>(size, init)` | 创建数组并用初始化函数填充 |
| `List(size, init)` | 按初始化函数创建列表 |
| `Pair(first, second)` | 创建键值对 |
| `pairOf(first, second)` | Pair 的别名 |
| `range(start, end)` | 创建半开区间 [start, end) |
| `rangeClosed(start, end)` | 创建闭区间 [start, end] |

```nova
val list = listOf(1, 2, 3)
val empty = emptyList()
val map = mapOf("a" to 1, "b" to 2)
val set = setOf(1, 2, 3)
val arr = Array<Int>(5) { i -> i * 2 }  // [0, 2, 4, 6, 8]
val gen = List(3) { i -> "item$i" }     // ["item0", "item1", "item2"]
val pair = "key" to "value"             // Pair 语法糖
```

## 数学函数

| 函数 | 说明 |
|------|------|
| `abs(x)` | 绝对值 |
| `min(a, b)` | 最小值 |
| `max(a, b)` | 最大值 |
| `sqrt(x)` | 平方根 |
| `pow(base, exp)` | 幂运算 |
| `floor(x)` | 向下取整 |
| `ceil(x)` | 向上取整 |
| `round(x)` | 四舍五入 |
| `random()` | 返回 [0.0, 1.0) 的随机数 |
| `sin(x)` | 正弦 |
| `cos(x)` | 余弦 |
| `tan(x)` | 正切 |
| `asin(x)` | 反正弦 |
| `acos(x)` | 反余弦 |
| `atan(x)` | 反正切 |
| `atan2(y, x)` | 两参数反正切 |
| `log(x)` | 自然对数 |
| `log10(x)` | 常用对数 |
| `log2(x)` | 以 2 为底的对数 |
| `exp(x)` | e 的 x 次方 |
| `sign(x)` | 符号函数（-1, 0, 1） |
| `clamp(value, min, max)` | 将值限制在范围内 |

## 错误处理函数

| 函数 | 说明 |
|------|------|
| `error(message)` | 抛出运行时错误 |
| `todo(message?)` | 抛出 "TODO: ..." 异常 |
| `assert(condition, message?)` | 断言，条件为 false 时抛出异常 |
| `require(condition, message?)` | 前置条件检查，条件为 false 时抛出异常 |

## Result 类型

| 函数 | 说明 |
|------|------|
| `Ok(value)` | 创建成功结果 |
| `Err(error)` | 创建失败结果 |
| `runCatching(block)` | 执行 block，成功返回 `Ok(result)`，异常返回 `Err(message)` |

```nova
fun divide(a: Int, b: Int): Result {
    if (b == 0) return Err("除以零")
    return Ok(a / b)
}

val r = divide(10, 2)
r.isOk      // true
r.value     // 5

// ? 操作符：错误传播
fun compute(): Result {
    val x = divide(10, 2)?  // 成功则取值，失败则提前返回 Err
    return Ok(x + 1)
}

// when 匹配
when (r) {
    is Ok -> println("成功: ${r.value}")
    is Err -> println("失败: ${r.error}")
}

// runCatching：安全执行，捕获异常
val result = runCatching { 10 / 0 }
result.isErr     // true
result.error     // "Division by zero"

// 链式操作
val value = runCatching { parseJson(input) }
    .map { it.name }
    .unwrapOr("unknown")
```

## 反射函数

| 函数 | 说明 |
|------|------|
| `classOf(classOrInstance)` | 返回 `ClassInfo` 反射对象，接受类引用或实例 |

```nova
class Person(val name: String, var age: Int)
val info = classOf(Person)
println(info.name)    // "Person"
println(info.fields)  // [FieldInfo(name), FieldInfo(age)]
```

详见 [反射 API 文档](反射API.md)。

## 注解函数

| 函数 | 说明 |
|------|------|
| `registerAnnotationProcessor(name, handler)` | 注册自定义注解处理器，返回句柄 |

句柄方法：`unregister()` 取消注册，`register()` 重新注册，`replace(handler)` 替换处理器。

详见 [注解系统文档](注解系统.md)。

## 作用域与工具函数

| 函数 | 说明 |
|------|------|
| `with(receiver, block)` | 以 receiver 为参数执行 block |
| `repeat(times, action)` | 重复执行 action，传入索引 |
| `measureTimeMillis(block)` | 测量代码块执行时间（毫秒） |
| `measureNanoTime(block)` | 测量代码块执行时间（纳秒） |
| `buildString(block)` | 构建字符串 |
| `buildList(block)` | 构建列表 |
| `buildMap(block)` | 构建 Map |
| `buildSet(block)` | 构建 Set |
| `async(block)` | 异步执行 block，返回 Future |

```nova
// repeat
repeat(3) { i -> println("第 $i 次") }

// measureTimeMillis
val elapsed = measureTimeMillis {
    // 耗时操作
}
println("耗时: ${elapsed}ms")

// buildList
val list = buildList {
    add(1)
    add(2)
    add(3)
}
```

## 并发函数

以下并发函数无需 `import nova.concurrent.*`，在全局作用域直接可用。

### 异步执行

| 函数 | 说明 |
|------|------|
| `launch(block)` | fire-and-forget 异步执行，返回 Job |
| `parallel(blocks...)` | 并行执行多个 lambda，返回所有结果列表 |
| `withTimeout(millis, block)` | 在超时时间内执行代码块，超时抛异常 |
| `awaitAll(futures)` | 等待所有 Future 完成，返回结果列表 |
| `awaitFirst(futures)` | 返回第一个完成的 Future 的结果 |
| `withContext(executor, block)` | 在指定 Executor 上执行 block 并等待结果 |

```nova
// 并行执行
val results = parallel(
    { fetchData("url1") },
    { fetchData("url2") },
    { fetchData("url3") }
)

// 超时控制
val result = withTimeout(3000) {
    // 必须在 3 秒内完成
    heavyComputation()
}

// launch + awaitAll
val f1 = launch { compute(1) }
val f2 = launch { compute(2) }
val f3 = launch { compute(3) }
val all = awaitAll([f1, f2, f3])

// awaitFirst：取最快结果
val fastest = awaitFirst([f1, f2, f3])
```

### 原子变量

| 函数 | 说明 |
|------|------|
| `AtomicInt(initial)` | 创建线程安全的原子整数 |
| `AtomicLong(initial)` | 创建线程安全的原子长整数 |
| `AtomicRef(initial)` | 创建线程安全的原子引用 |

```nova
val counter = AtomicInt(0)
counter.incrementAndGet()          // 1
counter.addAndGet(5)               // 6
counter.compareAndSet(6, 10)       // true, 值变为 10
println(counter.get())             // 10

val ref = AtomicRef("hello")
ref.set("world")
println(ref.get())                 // world
```

原子变量的完整方法列表见 [标准库模块 - nova.concurrent](标准库模块.md#novaconcurrent)。

### Channel

| 函数 | 说明 |
|------|------|
| `Channel()` | 创建无界通道 |
| `Channel(capacity)` | 创建有界通道 |

```nova
val ch = Channel(10)
ch.send(1)
ch.send(2)
ch.send(3)
ch.close()

// for-in 迭代 Channel
var sum = 0
for (msg in ch) {
    sum = sum + msg
}
println(sum)  // 6

// 带超时接收
val ch2 = Channel(10)
ch2.send(42)
val v = ch2.receiveTimeout(1000)  // 1 秒内等待
println(v)  // 42
```

Channel 的完整方法列表见 [标准库模块 - nova.concurrent](标准库模块.md#novaconcurrent)。

### Mutex

| 函数 | 说明 |
|------|------|
| `Mutex()` | 创建互斥锁 |

```nova
val m = Mutex()
val counter = AtomicInt(0)

parallel(
    { m.withLock { counter.addAndGet(1) } },
    { m.withLock { counter.addAndGet(1) } },
    { m.withLock { counter.addAndGet(1) } }
)
println(counter.get())  // 3
```

Mutex 的完整方法列表见 [标准库模块 - nova.concurrent](标准库模块.md#novaconcurrent)。

## Java 互操作

| 函数 | 说明 |
|------|------|
| `javaClass(className)` | 获取 Java 类引用（受安全策略限制） |

```nova
val list = javaClass("java.util.ArrayList")()
list.add("hello")
println(list.size())  // 1
```

## 内置常量

| 常量 | 值 |
|------|------|
| `PI` | 3.141592653589793 |
| `E` | 2.718281828459045 |
| `MAX_INT` | 2147483647 |
| `MIN_INT` | -2147483648 |
| `MAX_LONG` | 9223372036854775807 |
| `MIN_LONG` | -9223372036854775808 |
| `MAX_DOUBLE` | 1.7976931348623157E308 |
| `MIN_DOUBLE` | 4.9E-324 |
| `POSITIVE_INFINITY` | 正无穷 |
| `NEGATIVE_INFINITY` | 负无穷 |
| `NaN` | 非数字 |

---

## 内置类型成员方法

### String 方法

#### 基本属性与转换

| 方法 | 说明 |
|------|------|
| `length()` | 字符串长度 |
| `isEmpty()` | 是否为空 |
| `isNotEmpty()` | 是否非空 |
| `isBlank()` | 是否为空白（空或仅含空白字符） |
| `isNotBlank()` | 是否非空白 |
| `toString()` | 返回自身 |
| `toInt()` | 解析为 Int |
| `toDouble()` | 解析为 Double |
| `toLong()` | 解析为 Long |
| `toBoolean()` | 解析为 Boolean |

#### 大小写与空白

| 方法 | 说明 |
|------|------|
| `toUpperCase()` | 转为大写 |
| `toLowerCase()` | 转为小写 |
| `uppercase()` | 转为大写（别名） |
| `lowercase()` | 转为小写（别名） |
| `capitalize()` | 首字母大写 |
| `decapitalize()` | 首字母小写 |
| `trim()` | 去除首尾空白 |
| `trimStart()` | 去除开头空白 |
| `trimEnd()` | 去除末尾空白 |

#### 查找与判断

| 方法 | 说明 |
|------|------|
| `contains(sub)` | 是否包含子串 |
| `startsWith(prefix)` | 是否以指定前缀开头 |
| `endsWith(suffix)` | 是否以指定后缀结尾 |
| `indexOf(sub)` | 查找子串位置，未找到返回 -1 |
| `lastIndexOf(sub)` | 从末尾查找子串位置 |
| `matches(regex)` | 是否匹配正则表达式 |
| `compareTo(other)` | 字典序比较 |

#### 变换与提取

| 方法 | 说明 |
|------|------|
| `substring(start)` | 从 start 到末尾的子串 |
| `substring(start, end)` | 从 start 到 end 的子串 |
| `replace(target, replacement)` | 替换所有匹配项 |
| `replaceFirst(target, replacement)` | 替换第一个匹配项 |
| `split(separator)` | 按分隔符拆分为列表 |
| `reverse()` | 反转字符串 |
| `repeat(count)` | 重复字符串 |
| `padStart(length, char)` | 左填充到指定长度 |
| `padEnd(length, char)` | 右填充到指定长度 |
| `take(n)` | 取前 n 个字符 |
| `drop(n)` | 去掉前 n 个字符 |
| `first()` | 第一个字符 |
| `last()` | 最后一个字符 |
| `removePrefix(prefix)` | 移除前缀 |
| `removeSuffix(suffix)` | 移除后缀 |
| `removeSurrounding(prefix, suffix)` | 同时移除前缀和后缀 |
| `format(args...)` | 格式化字符串（Java String.format） |

#### 字符操作

| 方法 | 说明 |
|------|------|
| `chars()` | 返回字符列表 `List<Char>` |
| `toList()` | 同 `chars()` |
| `toCharArray()` | 转换为 Char 数组 |
| `chunked(size)` | 按指定大小分块 |
| `count()` | 字符串长度 |
| `count(predicate)` | 满足条件的字符数 |
| `lines()` | 按行拆分为列表 |

#### 连接

| 方法 | 说明 |
|------|------|
| `joinToString(separator)` | 用分隔符连接（用于列表结果） |

```nova
val s = "Hello, Nova!"
s.length()              // 12
s.toUpperCase()         // "HELLO, NOVA!"
s.contains("Nova")      // true
s.split(", ")           // ["Hello", "Nova!"]
s.replace("Nova", "World") // "Hello, World!"
s.substring(7)          // "Nova!"
"abc".repeat(3)         // "abcabcabc"
"hello".capitalize()    // "Hello"
"hello".padStart(10, '*') // "*****hello"
"hello".chars()         // ['h', 'e', 'l', 'l', 'o']
"hello".count { it == 'l' } // 2

// 单字符 String 也支持 Char 方法
"A".isUpperCase()       // true
"5".isDigit()           // true
"A".code                // 65
```

### Char 方法

`Char` 类型表示单个字符，由字符字面量 `'A'` 或字符串索引 `"hello"[0]` 产生。

| 方法/属性 | 说明 |
|-----------|------|
| `isDigit()` | 是否为数字字符 |
| `isLetter()` | 是否为字母 |
| `isWhitespace()` | 是否为空白字符 |
| `isUpperCase()` | 是否为大写 |
| `isLowerCase()` | 是否为小写 |
| `uppercase()` | 转为大写 Char |
| `lowercase()` | 转为小写 Char |
| `code` | 字符的 Unicode 码点（属性，不加括号） |
| `digitToInt()` | 数字字符转为对应整数（`'5'` → `5`） |
| `toString()` | 转为单字符 String |

```nova
val c = 'A'
c.isUpperCase()  // true
c.isLetter()     // true
c.code           // 65
c.lowercase()    // 'a'

'5'.isDigit()    // true
'5'.digitToInt() // 5

// 字符串索引返回 Char
"hello"[0]       // 'h'
"hello"[0].isLetter() // true

// for-in 遍历字符串产生 Char
for (ch in "hello") {
    println(ch.code)  // 104, 101, 108, 108, 111
}
```

### Number 方法

适用于所有数字类型（Int、Long、Double、Float）。

| 方法 | 说明 |
|------|------|
| `toInt()` | 转为 Int |
| `toLong()` | 转为 Long |
| `toDouble()` | 转为 Double |
| `toFloat()` | 转为 Float |
| `toString()` | 转为 String |
| `abs()` | 绝对值 |
| `coerceIn(min, max)` | 将值限制在 [min, max] 范围内 |
| `coerceAtLeast(min)` | 取 max(this, min) |
| `coerceAtMost(max)` | 取 min(this, max) |
| `downTo(to)` | 创建递减列表 [this, this-1, ..., to] |
| `until(to)` | 创建半开区间 Range [this, to) |
| `roundToInt()` | 四舍五入到 Int |
| `isNaN()` | 是否为 NaN |
| `isInfinite()` | 是否为无穷 |
| `isFinite()` | 是否为有限值 |

```nova
val x = 42
x.toDouble()           // 42.0
x.coerceIn(0, 100)     // 42
x.coerceIn(50, 100)    // 50

(-5).abs()             // 5
10.downTo(1)           // [10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
0.until(5)             // Range(0, 5) — 不含 5

3.14.roundToInt()      // 3
(0.0 / 0.0).isNaN()   // true
```

### List 方法

#### 基本操作

| 方法 | 说明 |
|------|------|
| `size()` | 列表大小 |
| `isEmpty()` | 是否为空 |
| `isNotEmpty()` | 是否非空 |
| `first()` | 第一个元素，空列表返回 null |
| `last()` | 最后一个元素，空列表返回 null |
| `contains(value)` | 是否包含元素 |
| `indexOf(value)` | 查找元素位置，未找到返回 -1 |
| `lastIndexOf(value)` | 从末尾查找元素位置 |

#### 修改操作

| 方法 | 说明 |
|------|------|
| `add(value)` | 添加元素到末尾 |
| `addAll(list)` | 添加另一个列表的所有元素 |
| `set(index, value)` | 设置指定位置的元素 |
| `remove(value)` | 移除第一个匹配的元素 |
| `removeAt(index)` | 移除指定位置的元素 |
| `clear()` | 清空列表 |

#### 查找与判断

| 方法 | 说明 |
|------|------|
| `find(predicate)` | 查找第一个满足条件的元素 |
| `findLast(predicate)` | 查找最后一个满足条件的元素 |
| `any(predicate)` | 是否存在满足条件的元素 |
| `all(predicate)` | 是否所有元素都满足条件 |
| `none(predicate)` | 是否没有元素满足条件 |
| `count()` | 元素数量 |
| `count(predicate)` | 满足条件的元素数量 |

#### 变换

| 方法 | 说明 |
|------|------|
| `map(transform)` | 映射转换 |
| `mapNotNull(transform)` | 映射并过滤 null 结果 |
| `mapIndexed(transform)` | 带索引映射 `(index, value) → result` |
| `flatMap(transform)` | 映射并展平结果 |
| `flatten()` | 展平嵌套列表 |
| `filter(predicate)` | 过滤元素 |
| `filterNot(predicate)` | 反向过滤 |
| `filterIndexed(predicate)` | 带索引过滤 `(index, value) → Boolean` |

#### 聚合

| 方法 | 说明 |
|------|------|
| `reduce(initial, operation)` | 累积计算 |
| `fold(initial, operation)` | 从左到右折叠 |
| `foldRight(initial, operation)` | 从右到左折叠 |
| `sum()` | 求和 |
| `average()` | 求平均值 |
| `maxOrNull()` | 最大值，空列表返回 null |
| `minOrNull()` | 最小值，空列表返回 null |
| `maxBy(selector)` | 按选择器取最大元素 |
| `minBy(selector)` | 按选择器取最小元素 |
| `sumBy(selector)` | 按选择器求和 |

#### 排序与去重

| 方法 | 说明 |
|------|------|
| `sorted()` | 自然排序 |
| `sortedDescending()` | 降序排序 |
| `sortBy(selector)` | 按选择器排序 |
| `reversed()` | 反转 |
| `shuffled()` | 随机打乱 |
| `distinct()` | 去重 |
| `distinctBy(selector)` | 按选择器去重 |

#### 分组与分区

| 方法 | 说明 |
|------|------|
| `groupBy(keySelector)` | 按键分组，返回 `Map<Key, List>` |
| `associateBy(keySelector)` | 按键关联，返回 `Map<Key, Value>` |
| `associateWith(valueSelector)` | 按值关联，返回 `Map<Item, Value>` |
| `partition(predicate)` | 分成满足/不满足两个列表，返回 Pair |
| `chunked(size)` | 按固定大小分块 |
| `windowed(size, step?)` | 滑动窗口 |
| `zip(other)` | 与另一个列表配对 |
| `unzip()` | 拆分 Pair 列表为两个列表 |

#### 子列表

| 方法 | 说明 |
|------|------|
| `take(n)` | 取前 n 个元素 |
| `takeLast(n)` | 取后 n 个元素 |
| `takeWhile(predicate)` | 从头取直到不满足条件 |
| `drop(n)` | 去掉前 n 个元素 |
| `dropLast(n)` | 去掉后 n 个元素 |
| `dropWhile(predicate)` | 从头去掉直到不满足条件 |
| `subList(from, to)` | 子列表 [from, to) |
| `slice(range)` | 按 Range 切片 |

#### 集合运算

| 方法 | 说明 |
|------|------|
| `intersect(other)` | 交集 |
| `subtract(other)` | 差集 |
| `union(other)` | 并集（去重） |

#### 遍历

| 方法 | 说明 |
|------|------|
| `forEach(action)` | 遍历元素 |
| `forEachIndexed(action)` | 带索引遍历 `(index, value)` |

#### 转换

| 方法 | 说明 |
|------|------|
| `joinToString(separator)` | 用分隔符连接 |
| `toSet()` | 转为 Set |
| `toMap()` | Pair 列表转为 Map |
| `toMutableList()` | 复制为可变列表 |
| `withIndex()` | 返回 `List<Pair(index, value)>` |

```nova
val list = [1, 2, 3, 4, 5]
list.size()                         // 5
list.first()                        // 1
list.map { it * 2 }                 // [2, 4, 6, 8, 10]
list.filter { it > 3 }              // [4, 5]
list.reduce(0) { acc, x -> acc + x } // 15
list.any { it > 4 }                 // true
list.all { it > 0 }                 // true
list.find { it > 3 }                // 4
list.sorted()                       // [1, 2, 3, 4, 5]
list.reversed()                     // [5, 4, 3, 2, 1]
list.distinct()                     // [1, 2, 3, 4, 5]
list.take(3)                        // [1, 2, 3]
list.drop(2)                        // [3, 4, 5]
list.chunked(2)                     // [[1, 2], [3, 4], [5]]
list.groupBy { it % 2 }             // {1: [1, 3, 5], 0: [2, 4]}
list.partition { it > 3 }           // Pair([4, 5], [1, 2, 3])
list.joinToString(", ")             // "1, 2, 3, 4, 5"

// zip
[1, 2, 3].zip(["a", "b", "c"])     // [Pair(1, "a"), Pair(2, "b"), Pair(3, "c")]

// fold
[1, 2, 3].fold(10) { acc, x -> acc + x }  // 16
```

### Map 方法

#### 基本操作

| 方法 | 说明 |
|------|------|
| `size()` | Map 大小 |
| `isEmpty()` | 是否为空 |
| `isNotEmpty()` | 是否非空 |
| `keys()` | 所有键的列表 |
| `values()` | 所有值的列表 |
| `entries()` | 所有键值对列表，每项为 `{key, value}` |

#### 查找与访问

| 方法 | 说明 |
|------|------|
| `get(key)` | 获取值，不存在返回 null |
| `getOrDefault(key, default)` | 获取值，不存在返回默认值 |
| `getOrPut(key, defaultValue)` | 获取值，不存在则插入默认值并返回 |
| `containsKey(key)` | 是否包含键 |
| `containsValue(value)` | 是否包含值 |

#### 修改操作

| 方法 | 说明 |
|------|------|
| `put(key, value)` | 添加或更新键值对 |
| `putAll(otherMap)` | 合并另一个 Map |
| `remove(key)` | 移除键值对 |
| `clear()` | 清空 Map |

#### 变换

| 方法 | 说明 |
|------|------|
| `map(transform)` | 映射每个条目，返回列表 |
| `mapKeys(transform)` | 变换键 |
| `mapValues(transform)` | 变换值 |
| `flatMap(transform)` | 映射并展平 |
| `filter(predicate)` | 过滤条目 |
| `filterKeys(predicate)` | 按键过滤 |
| `filterValues(predicate)` | 按值过滤 |

#### 判断

| 方法 | 说明 |
|------|------|
| `any(predicate)` | 是否存在满足条件的条目 |
| `all(predicate)` | 是否所有条目都满足条件 |
| `none(predicate)` | 是否没有条目满足条件 |
| `count()` | 条目数量 |
| `count(predicate)` | 满足条件的条目数量 |

#### 遍历与转换

| 方法 | 说明 |
|------|------|
| `forEach(action)` | 遍历，回调接收 `(key, value)` |
| `toList()` | 转为 `List<Pair>` |
| `toMutableMap()` | 复制为可变 Map |
| `merge(other)` | 合并两个 Map，返回新 Map |

```nova
val map = #{"name": "Alice", "age": 30}
map.size()                        // 2
map.keys()                        // ["name", "age"]
map.containsKey("name")           // true
map.getOrDefault("email", "N/A")  // "N/A"

map.forEach { k, v -> println("$k = $v") }
map.mapValues { it.value.toString() }
map.filterKeys { it != "age" }
map.toList()                      // [Pair("name", "Alice"), Pair("age", 30)]
```

> Map 变换回调中，`it` 为 `{key, value}` 结构，可通过 `it.key` 和 `it.value` 访问。

### Set 方法

| 方法 | 说明 |
|------|------|
| `size()` | Set 大小 |
| `isEmpty()` | 是否为空 |
| `isNotEmpty()` | 是否非空 |
| `contains(value)` | 是否包含元素 |
| `add(value)` | 添加元素 |
| `remove(value)` | 移除元素 |
| `clear()` | 清空 |
| `toList()` | 转为列表 |
| `forEach(action)` | 遍历 |
| `map(transform)` | 映射转换 |
| `filter(predicate)` | 过滤元素 |

```nova
val set = setOf(1, 2, 3)
set.contains(2)    // true
set.add(4)
set.size()         // 4
set.toList()       // [1, 2, 3, 4]
set.map { it * 2 } // [2, 4, 6, 8]
```

### Range 方法

Range 是惰性序列，`1..10` 和 `0..<n` 不会立即生成所有元素。

| 方法/属性 | 说明 |
|-----------|------|
| `size()` | 范围大小 |
| `contains(value)` | 是否包含值 |
| `toList()` | 转换为列表 |
| `first` | 起始值（属性） |
| `last` | 结束值（属性） |
| `forEach(action)` | 遍历范围 |
| `map(transform)` | 映射转换 |
| `filter(predicate)` | 过滤元素 |

```nova
val r = 1..10
r.size()        // 10
r.contains(5)   // true
r.first         // 1
r.last          // 10
r.toList()      // [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
r.map { it * it } // [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]

val half = 0..<5  // 半开区间 [0, 5)
half.toList()     // [0, 1, 2, 3, 4]
```

### Array 方法

原生数组，支持按类型优化（`Array<Int>`、`Array<Double>` 等）。

| 方法/属性 | 说明 |
|-----------|------|
| `size` | 数组长度（属性） |
| `toList()` | 转换为列表 |
| `forEach(action)` | 遍历数组 |
| `map(transform)` | 映射转换 |
| `filter(predicate)` | 过滤元素 |
| `contains(value)` | 是否包含元素 |
| `indexOf(value)` | 查找元素位置 |

```nova
val arr = arrayOf(10, 20, 30)
arr.size           // 3
arr[0]             // 10
arr[1] = 25        // 修改元素
arr.toList()       // [10, 25, 30]
arr.contains(25)   // true
```

### Pair 方法

| 方法/属性 | 说明 |
|-----------|------|
| `first` | 第一个元素（属性） |
| `second` | 第二个元素（属性） |
| `toList()` | 转换为两元素列表 |

```nova
val p = "name" to "Alice"
p.first    // "name"
p.second   // "Alice"
p.toList() // ["name", "Alice"]
```

---

## 作用域函数

所有类型都可调用以下作用域函数：

### let

将对象作为参数传入 Lambda，返回 Lambda 的结果：

```nova
val result = "Hello".let { it.length() }  // 5

// 常用于 null 安全处理
val name: String? = getName()
name?.let { println("名字: $it") }
```

### also

将对象作为参数传入 Lambda，返回对象本身：

```nova
val list = mutableListOf(1, 2, 3).also { println(it) }
// 打印 [1, 2, 3]，list = [1, 2, 3]
```

### run

以对象为 `this` 执行 Lambda，返回 Lambda 的结果：

```nova
val len = "Hello".run { length() }  // 5（this 是 "Hello"）
```

### apply

以对象为 `this` 执行 Lambda，返回对象本身：

```nova
val list = mutableListOf().apply {
    add(1)
    add(2)
    add(3)
}
// list = [1, 2, 3]
```

### takeIf

条件为 true 时返回对象，否则返回 null：

```nova
val even = 4.takeIf { it % 2 == 0 }  // 4
val odd = 3.takeIf { it % 2 == 0 }   // null
```

### takeUnless

条件为 false 时返回对象，否则返回 null：

```nova
val notEmpty = "hello".takeUnless { it.isEmpty() }  // "hello"
```
